{% extends "base.html" %}
{% block title %}Submit Album{% endblock %}
{% block content %}
  <h2 class="mb-4">Submit a New Album</h2>
  <!-- 🔍 Search bar -->
  <form method="get" class="mb-3">
    <input type="text"
           name="q"
           class="form-control"
           placeholder="Search for an album..."
           value="{{ query }}">
    <button type="submit" class="btn btn-primary mt-2">Search</button>
  </form>
  <!-- 🎯 Show results -->
  {% if search_results %}
    <h5>Select an album to autofill:</h5>
    <ul class="list-group mb-4">
      {% for result in search_results %}
        <li class="list-group-item d-flex align-items-center justify-content-between">
          <div class="d-flex align-items-center">
            {% with result.get_cover_image as cover %}
              {% if cover %}
                <img src="{{ cover }}"
                     alt="Album Art"
                     style="width: 40px;
                            height: 40px;
                            object-fit: cover;
                            margin-right: 10px">
              {% endif %}
            {% endwith %}
            <span>{{ result.artist }} – {{ result.title }}</span>
          </div>
          <button class="btn btn-sm btn-outline-info"
                  onclick="fillForm('{{ result.artist }}', '{{ result.title }}')">Use</button>
        </li>
      {% endfor %}
    </ul>
  {% endif %}
  <!-- ✅ Submission form -->
  <form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-success">Submit Album</button>
  </form>
  <!-- 💡 JS to autofill form -->
  <script>
function fillForm(artist, title) {
  document.getElementById('id_artist').value = artist;
  document.getElementById('id_title').value = title;

  // Optional: fetch genre via AJAX call to your backend
}
  </script>
{% endblock %}
